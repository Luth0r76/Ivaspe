<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Online Interactivo | Jose Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #ff6b6b 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 110px; 
            animation: gradientShift 15s ease infinite;
            transition: padding-top 0.3s ease; 
        }

        @keyframes gradientShift {
            0%, 100% {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #ff6b6b 100%);
            }
            50% {
                background: linear-gradient(135deg, #ff6b6b 0%, #667eea 50%, #764ba2 100%);
            }
        }

        .navbar {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            color: white;
            padding: 10px 20px; 
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }

        .academy-name {
            font-size: 1.6em; 
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px; 
            margin-bottom: 8px; 
            transition: font-size 0.3s ease; 
        }

        .robot-icon {
            font-size: 0.9em; 
            animation: bounce 2s ease-in-out infinite;
            transition: font-size 0.3s ease;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-6px); } 
            60% { transform: translateY(-3px); }
        }
        
        .global-progress-wrapper-navbar {
            width: 100%;
            max-width: 900px; 
            padding: 0 10px; 
            box-sizing: border-box;
            margin-top: 5px; 
        }

        .progress-info-text-navbar {
            text-align: right;
            font-size: 0.8em; 
            color: #e2e8f0; 
            margin-bottom: 3px; 
        }

        .progress-container-navbar { 
            width: 100%;
            background-color: rgba(255, 255, 255, 0.2); 
            border-radius: 6px; 
            height: 8px;  
            overflow: hidden;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
        }

        .progress-bar-navbar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #68d391, #48bb78); 
            border-radius: 6px; 
            transition: width 0.5s ease-in-out;
        }

        .container {
            max-width: 900px;
            width: 95%;
            margin: 20px auto 20px auto; 
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            padding: 20px;
        }

        .content-section {
            display: none;
            padding: 20px;
            border-radius: 15px;
            background-color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
        }

        .content-section.active {
            display: block;
        }

        .screen-title { 
            font-size: 1.8em;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
         .screen-description p { 
            font-size: 1.1em;
            color: #555;
            margin-bottom: 25px;
            line-height: 1.6;
            text-align: center;
        }
        .screen-description ul {
            list-style-position: inside;
            text-align: left;
            max-width: 500px;
            margin: 0 auto 25px auto;
        }
         .screen-description li {
            margin-bottom: 8px;
        }


        .btn {
            background: linear-gradient(135deg, #805ad5, #6b46c1);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 8px 15px rgba(107, 70, 193, 0.3);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #a0aec0, #718096);
        }
         .btn-secondary:hover {
            box-shadow: 0 8px 15px rgba(113, 128, 150, 0.3);
        }
        .btn-training { 
             background: linear-gradient(135deg, #48bb78, #38a169);
        }
         .btn-training:hover {
            box-shadow: 0 8px 15px rgba(72, 187, 120, 0.3);
        }
        .btn-study { 
            background: linear-gradient(135deg, #f6ad55, #ed8936); 
        }
        .btn-study:hover {
            box-shadow: 0 8px 15px rgba(237, 137, 54, 0.3);
        }
        .btn-exam { 
             background: linear-gradient(135deg, #4299e1, #3182ce); 
        }
        .btn-exam:hover {
            box-shadow: 0 8px 15px rgba(66, 153, 225, 0.3);
        }


        #countdown {
            font-size: 5em;
            font-weight: bold;
            color: #6b46c1;
            margin: 30px 0;
            text-align: center;
        }

        .question-container {
            padding: 25px;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 5px solid #6b46c1;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .question-header {
            display: flex;
            flex-wrap: wrap; 
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px; 
        }
        .question-category {
            font-size: 0.9em;
            color: #555;
            background-color: #e2e8f0;
            padding: 5px 10px;
            border-radius: 20px;
        }
        .question-number {
            font-size: 1em;
            font-weight: bold;
            color: #6b46c1;
        }
        .test-mode-info {
            font-size: 0.85em;
            color: #4a5568; 
            background-color: #edf2f7; 
            padding: 6px 12px;
            border-radius: 15px;
            text-align: center;
            width: 100%; 
            order: 3; 
            margin-top: 5px;
        }


        .question-text {
            font-weight: bold;
            margin-bottom: 18px;
            color: #2d3748;
            font-size: 1.15em;
            line-height: 1.5;
        }

        .options {
            display: grid;
            gap: 12px;
        }

        .option {
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            font-size: 1em;
        }
        .option.disabled { 
            cursor: not-allowed;
            opacity: 0.7;
            pointer-events: none; 
        }


        .option:hover:not(.disabled) {
            border-color: #805ad5;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(128, 90, 213, 0.2);
        }

        .option.selected:not(.disabled) {
            background: #b794f4;
            color: white;
            border-color: #805ad5;
        }

        .option.correct {
            background: #48bb78 !important;
            color: white !important;
            border-color: #38a169 !important;
        }

        .option.incorrect { 
            background: #f56565 !important;
            color: white !important;
            border-color: #e53e3e !important;
        }
        
        .navigation-buttons, .correction-buttons { 
            text-align: center;
            margin-top: 20px;
        }
        #instantCorrectionFeedback {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
        }
        #instantCorrectionFeedback.correct {
            background-color: #c6f6d5; color: #22543d;
        }
        #instantCorrectionFeedback.incorrect {
            background-color: #fed7d7; color: #742a2a;
        }


        #score-percentage {
            font-size: 3.5em;
            font-weight: bold;
            margin: 20px 0;
        }
        #score-details {
            font-size: 1.2em;
            color: #4a5568;
            margin-bottom: 25px;
        }
        .results-summary {
            margin-top: 30px;
            text-align: left;
        }
        .result-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left-width: 4px;
            border-left-style: solid;
        }
        .result-item.correct {
            background-color: #c6f6d5;
            border-left-color: #38a169;
        }
        .result-item.incorrect {
            background-color: #fed7d7;
            border-left-color: #e53e3e;
        }
        .result-item p { margin-bottom: 5px; }
        .result-item strong { color: #2d3748; }

        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .topic-button { 
            padding: 20px;
            font-size: 1.1em;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .topic-button:hover {
            transform: translateY(-5px);
        }

        .footer {
            background: #2d3748;
            color: white;
            padding: 20px;
            text-align: center;
            width: 100%;
            margin-top: auto; 
            box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.2);
            transition: padding 0.3s ease, font-size 0.3s ease; /* Transición para suavizar cambio de tamaño */
        }
        .footer p {
            transition: font-size 0.3s ease; /* Transición para el texto del footer */
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fff;
            margin: auto;
            padding: 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .modal-content h2 {
            margin-top: 0;
            color: #333;
        }
        .modal-content p {
            color: #555;
            font-size: 1.1em;
            margin-bottom: 20px;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .button-group { 
            display: flex;
            flex-direction: column; 
            gap: 15px; 
            align-items: center; 
            margin-top: 20px;
        }
        .button-group .btn {
            width: 80%; 
            max-width: 350px; 
        }

        /* Ajustes para móvil cuando el test está activo */
        @media (max-width: 768px) {
            body.test-mode-active {
                padding-top: 95px; 
            }
            body.test-mode-active .navbar .academy-name {
                font-size: 1.2em; 
            }
            body.test-mode-active .navbar .robot-icon {
                font-size: 0.8em; 
            }
            body.test-mode-active .footer {
                padding: 10px; /* Footer más compacto en móvil durante el test */
            }
            body.test-mode-active .footer p {
                font-size: 0.8em; /* Texto del footer más pequeño */
            }
        }

    </style>
</head>

<body>
    <nav class="navbar">
        <div class="academy-name">
            🚀 Jose Academy <span class="robot-icon">🤖</span>
        </div>
        <div id="globalProgressWrapperNavbar" class="global-progress-wrapper-navbar" style="display: none;">
            <div id="progressInfoTextNavbar" class="progress-info-text-navbar">Progreso: 0%</div>
            <div class="progress-container-navbar">
                <div class="progress-bar-navbar" id="progressBarNavbar"></div>
            </div>
        </div>
    </nav>

    <div class="container">
        <div id="studyMethodSelectionScreen" class="content-section active">
            <h2 class="screen-title">🎯 Elige tu Método de Aprendizaje</h2>
            <div class="screen-description">
                <p>Selecciona cómo quieres prepararte:</p>
            </div>
            <div class="button-group">
                <button class="btn btn-study" onclick="selectStudyMethod('study')">📚 Modo Estudio</button>
                <button class="btn btn-exam" onclick="selectStudyMethod('exam')">📝 Modo Examen</button>
            </div>
        </div>

        <div id="studyTestSelectionScreen" class="content-section">
            <h2 class="screen-title">📚 Modo Estudio</h2>
            <div class="screen-description">
                <p>En este modo, podrás corregir cada pregunta al instante.</p>
                <p>Elige el tipo de test:</p>
            </div>
            <div class="button-group">
                <button class="btn btn-study" onclick="startTest('all_questions', '', 'study')">🚀 Test Completo (Estudio)</button>
                <button class="btn btn-study" onclick="showTopicSelectionScreen('study')">🎯 Entrenamiento por Tema (Estudio)</button>
            </div>
            <div class="text-center mt-6">
                 <button class="btn btn-secondary" onclick="showScreen('studyMethodSelectionScreen')">Volver</button>
            </div>
        </div>

        <div id="examTestSelectionScreen" class="content-section">
            <h2 class="screen-title">📝 Modo Examen</h2>
             <div class="screen-description">
                <p>En este modo, la corrección se mostrará al finalizar todas las preguntas.</p>
                <p>Elige el tipo de test:</p>
            </div>
            <div class="button-group">
                <button class="btn btn-exam" onclick="startTest('all_questions', '', 'exam')">🚀 Test Completo (Examen)</button>
                <button class="btn btn-exam" onclick="showTopicSelectionScreen('exam')">🎯 Entrenamiento por Tema (Examen)</button>
            </div>
             <div class="text-center mt-6">
                <button class="btn btn-secondary" onclick="showScreen('studyMethodSelectionScreen')">Volver</button>
            </div>
        </div>

        <div id="topicSelectionScreen" class="content-section">
            <h2 class="screen-title">📚 Elige un Tema para Entrenar</h2>
            <div id="topicGrid" class="topic-grid">
                </div>
            <div class="text-center mt-6">
                <button id="backFromTopicSelectionButton" class="btn btn-secondary">Volver</button>
            </div>
        </div>

        <div id="countdownScreen" class="content-section">
            <h2 class="screen-title">⏳ Preparando el Test...</h2>
            <div id="countdown">3</div>
        </div>

        <div id="testScreen" class="content-section">
            <div id="questionContainer" class="question-container">
                </div>
            <div id="instantCorrectionFeedback" class="mt-3 p-3 rounded-md" style="display:none;">
                </div>
            <div class="correction-buttons" id="correctionButtonContainer">
                 </div>
            <div class="navigation-buttons">
                <button id="prevButton" class="btn btn-secondary" onclick="prevQuestion()">⬅️ Anterior</button>
                <button id="nextButton" class="btn" onclick="nextQuestion()">Siguiente ➡️</button>
                <button id="finishButton" class="btn btn-training" onclick="finishTest()" style="display:none;">🏁 Finalizar Test</button>
            </div>
        </div>

        <div id="resultsScreen" class="content-section">
            <h2 class="screen-title">🏆 Resultados del Test</h2>
            <div id="scorePercentage" class="text-center">0%</div>
            <div id="scoreDetails" class="text-center">
                Has respondido <strong id="correctAnswers">0</strong> de <strong id="totalAnswered">0</strong> preguntas correctamente.
            </div>
            <div id="resultsSummary" class="results-summary">
                </div>
            <div class="text-center mt-6">
                <button class="btn btn-training" onclick="restartApp()">🔄 Reiniciar Test Completo</button>
                <button class="btn btn-secondary" onclick="showScreen('studyMethodSelectionScreen')">Elegir Otro Método/Test</button>
            </div>
        </div>
    </div>

    <div id="messageModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Mensaje</h2>
            <p id="modalMessage">Este es un mensaje de prueba.</p>
            <button class="btn" onclick="closeModal()">Aceptar</button>
        </div>
    </div>

    <footer class="footer">
        <p>🤖 <strong>Jose Academy</strong> - Aprende de forma interactiva</p>
        <p>© <span id="currentYear"></span> Jose Academy. Educación tecnológica del futuro.</p>
    </footer>

    <script>
        // --- VARIABLES GLOBALES ---
        let currentQuestionIndex = 0;
        let userAnswers = []; 
        let currentStudyMethodType = 'exam'; 
        let currentTestScope = 'all_questions'; 
        let selectedTopic = '';   
        let score = 0;
        let countdownTimer;
        let loadedQuestions = []; 

        const allQuestions = [
            // Derecho Penal (de Derecho Penal 2 Test.pdf y Derecho Penal TEST.pdf)
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "El artículo 250 de la Lecrim, establece los derechos del detenido, entre ellos:",
                options: [
                    { text: "Derecho a declarar la denuncia", value: "a" },
                    { text: "Derecho a no declarar", value: "b" },
                    { text: "Derecho a declarar con un familiar durante la detención", value: "c" },
                    { text: "Derecho a leer los derechos del detenido", value: "d" }
                ],
                correctAnswer: "b"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "En el caso del conductor de un vehículo, que ha cometido una infracción se negara a identificarse:",
                options: [
                    { text: "Deberemos dejarle marchar está en su derecho.", value: "a" },
                    { text: "Es un delito de negativa y procedemos a su detención.", value: "b" },
                    { text: "Inmovilizaremos el vehículo y las llaves del mismo.", value: "c" },
                    { text: "Le informamos de que tiene la obligación de identificarse y en caso de reiterada negativa, podrá ser requerido para que nos acompañe a la comisaría más cercana a efectos de identificación.", value: "d" }
                ],
                correctAnswer: "d"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "Cuando se lesiona un Bien jurídico protegido BJP, siempre existirá una respuesta penal dentro de unos límites:",
                options: [
                    { text: "Principio de presunción de inocencia", value: "a" },
                    { text: "Principio de culpabilidad", value: "b" },
                    { text: "Principio de legalidad", value: "c" },
                    { text: "Todas las respuestas son constitucionales", value: "d" }
                ],
                correctAnswer: "d"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "Cuando hablamos de tipo de delito, distinguimos entre:",
                options: [
                    { text: "Delito de acción y omisión", value: "a" },
                    { text: "Delito de lesión y peligro", value: "b" },
                    { text: "Delitos dolosos y imprudentes", value: "c" },
                    { text: "Todas las respuestas son correctas", value: "d" }
                ],
                correctAnswer: "d"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "Consecuencia de un siniestro vial, por imprudencia grave de su conductor, se produce un resultado de muerte, estamos ante un delito:",
                options: [
                    { text: "Delito privado, únicamente perseguible mediante querella", value: "a" },
                    { text: "Hecho atípico, no hay reproche penal", value: "b" },
                    { text: "Público por homicidio art. 142.1 del CP", value: "c" },
                    { text: "Privado 142.1 del CP", value: "d" }
                ],
                correctAnswer: "c"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "El delito de conducir un vehículo a motor o ciclomotor sin haber obtenido nunca el permiso o licencia de conducción:",
                options: [
                    { text: "No existe en el CP", value: "a" },
                    { text: "No establece pena de prisión alguna", value: "b" },
                    { text: "Está derogado y pasa a ser infracción administrativa", value: "c" },
                    { text: "Es un delito público establecido en el artículo 384 del CP", value: "d" }
                ],
                correctAnswer: "d"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "La persona que conduzca un vehículo a motor o ciclomotor con una tasa de alcohol en aire espirado superior a 0.60 mg/l, estaría cometiendo:",
                options: [
                    { text: "Delito del art.379.2 del CP.", value: "a" },
                    { text: "Se puede circular por la vía con una tasa de alcohol indicada.", value: "b" },
                    { text: "No existe infracción alguna", value: "c" },
                    { text: "Infracción administrativa sin retirada de puntos.", value: "d" }
                ],
                correctAnswer: "a"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "Si observamos una descarga ilegal de aguas residuales de un barco al mar, cerca del puerto, se estaría cometiendo:",
                options: [
                    { text: "Pediremos que lo recoja o lo disperse por el mar", value: "a" },
                    { text: "Un delito contra el medio ambiente", value: "b" },
                    { text: "No podemos realizar ninguna acción ya que es legal", value: "c" },
                    { text: "Todas las respuestas son correctas", value: "d" }
                ],
                correctAnswer: "b"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "Realizando patrulla nocturna, observamos contenedores en medio de la vía puestos tras una curva. Los causantes de colocar esos contenedores, ¿de qué delito podrían ser responsables?",
                options: [
                    { text: "Art. 385 del CP (Delito contra la seguridad vial por obstáculo)", value: "a" },
                    { text: "Denunciaremos a la pareja por bajar del vehículo", value: "b" },
                    { text: "No existe delito penal", value: "c" },
                    { text: "Los contenedores no se consideran obstáculos de tipo penal", value: "d" }
                ],
                correctAnswer: "a"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "Regulando el tráfico, un ciclomotor no obedece señales. Al detenerlo, se encuentran 150 gramos de marihuana en su mochila. Estamos ante:",
                options: [
                    { text: "Infracción administrativa LO 4/2015", value: "a" },
                    { text: "Le dejaremos marchar ya que es consumo propio", value: "b" },
                    { text: "Un delito contra la salud pública", value: "c" },
                    { text: "Es una situación atípica y no tiene reproche penal", value: "d" }
                ],
                correctAnswer: "c"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "El artículo 10 del Código penal establece:",
                options: [
                    { text: "Las penas privativas de libertad", value: "a" },
                    { text: "Son delito las acciones y omisiones dolosas o imprudentes penadas por la ley.", value: "b" },
                    { text: "Los delitos de homicidio", value: "c" },
                    { text: "La definición de delito grave", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "Aquellas lesiones que no requieren tratamiento médico quirúrgico alguno son consideradas como:",
                options: [
                    { text: "Leve", value: "a" },
                    { text: "Menos Grave", value: "b" },
                    { text: "Grave", value: "c" },
                    { text: "Muy Grave", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "Cuando estamos ante el hecho de abandonar el lugar del accidente, un conductor de forma voluntaria el cual ha causado a otra persona lesiones graves, se trata de:",
                options: [
                    { text: "Delito de omisión del deber de socorro", value: "a" },
                    { text: "Delito de abandono del lugar del accidente", value: "b" },
                    { text: "Delito de lesiones leves", value: "c" },
                    { text: "Delito de estafa", value: "d" }
                ],
                correctAnswer: "b"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "En los delitos de agresión sexual en su tipo básico, ¿el consentimiento está presente?",
                options: [
                    { text: "No hay consentimiento", value: "a" },
                    { text: "Siempre hay una acción conjunta de personas", value: "b" },
                    { text: "Hay una situación de superioridad", value: "c" },
                    { text: "Sí, pero viciado", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "Distinguimos entre el delito de hurto menos grave y leve:",
                options: [
                    { text: "Por el empleo de la fuerza", value: "a" },
                    { text: "Por el consentimiento del dueño de la causa mueble", value: "b" },
                    { text: "En función del valor de lo sustraído (si supera los 400 euros es menos grave)", value: "c" },
                    { text: "El delito de hurto siempre es grave y conlleva prisión", value: "d" }
                ],
                correctAnswer: "c"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "Jóvenes consumiendo en el muelle Sur, se observa marihuana en pequeña cantidad. Esto es:",
                options: [
                    { text: "Delito contra la salud pública", value: "a" },
                    { text: "Delito contra el medio ambiente", value: "b" },
                    { text: "Infracción administrativa (LO 4/2015)", value: "c" },
                    { text: "Es una conducta legal dentro del área portuaria.", value: "d" }
                ],
                correctAnswer: "c"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "Conductor estacionado en plaza de movilidad reducida con tarjeta aparentemente falsa. Estamos ante:",
                options: [
                    { text: "No existe delito en esta acción", value: "a" },
                    { text: "Un delito de falsedad documental", value: "b" },
                    { text: "Se trata de una sanción administrativa", value: "c" },
                    { text: "Un delito de usurpación de funciones", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "Cuando una persona agrede o acomete de forma grave o violenta a algún agente de la autoridad, estamos ante un delito de:",
                options: [
                    { text: "Desobediencia", value: "a" },
                    { text: "Amenaza", value: "b" },
                    { text: "Coacción", value: "c" },
                    { text: "Atentado", value: "d" }
                ],
                correctAnswer: "d"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "La negativa a someterse a las pruebas de alcohol o drogas legalmente establecidas, supone un delito de:",
                options: [
                    { text: "Tasa de alcohol delictiva art. 379.2 CP", value: "a" },
                    { text: "Negativa art. 383 CP", value: "b" },
                    { text: "Conducción temeraria art. 380 CP", value: "c" },
                    { text: "Conducir careciendo de permiso", value: "d" }
                ],
                correctAnswer: "b"
            },
            {
                category: "Derecho Penal", emoji: "⚖️",
                questionText: "El Código penal clasifica los delitos como:",
                options: [
                    { text: "Leve", value: "a" },
                    { text: "Menos grave", value: "b" },
                    { text: "Grave", value: "c" },
                    { text: "Todas son correctas", value: "d" }
                ],
                correctAnswer: "d"
            },

            // Drogas (de Drogas Test.pdf)
            {
                category: "Drogas", emoji: "💊",
                questionText: "La OMS define droga como:",
                options: [
                    { text: "Sustancia terapéutica", value: "a" },
                    { text: "Sustancia no terapéutica", value: "b" },
                    { text: "Sustancia terapéutica o no", value: "c" },
                    { text: "Ninguna de las anteriores", value: "d" }
                ],
                correctAnswer: "c"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "El estado de adaptación caracterizado por la disminución de la respuesta a la misma cantidad de droga, o por necesidad de una dosis mayor para provocar y sentir el mismo efecto se denomina:",
                options: [
                    { text: "Tolerancia", value: "a" },
                    { text: "Adicción", value: "b" },
                    { text: "Abuso de drogas", value: "c" },
                    { text: "Dependencia", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "Qué tipo de consumidor es aquel que consume sustancias cada fin de semana:",
                options: [
                    { text: "Consumo experimental o casual", value: "a" },
                    { text: "Consumo ocasional esporádico o social", value: "b" },
                    { text: "Consumo sistemático o habitual", value: "c" },
                    { text: "Consumo abusivo", value: "d" }
                ],
                correctAnswer: "c"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "Qué tipo de droga afecta al sistema nervioso central (SNC), acelerando el funcionamiento del cerebro:",
                options: [
                    { text: "Depresores", value: "a" },
                    { text: "Estimulantes", value: "b" },
                    { text: "Alucinógenos", value: "c" },
                    { text: "Cannabinoides", value: "d" }
                ],
                correctAnswer: "b"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "Cuál de los siguientes son síntomas de consumo de alcohol:",
                options: [
                    { text: "Desinhibición", value: "a" },
                    { text: "Descoordinación motora", value: "b" },
                    { text: "Euforia", value: "c" },
                    { text: "Todas son correctas", value: "d" }
                ],
                correctAnswer: "d"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "Según el artículo 379.2 del CP, ¿cuál es la tasa penal que se considera delito?",
                options: [
                    { text: "Aire espirado > 0,60 g/l o sangre > 1,2 g/l", value: "a" },
                    { text: "Aire espirado > 0,40 mg/l o sangre > 1,2 g/l", value: "b" },
                    { text: "Aire espirado > 0,60 g/l o sangre > 1,2 mg/l", value: "c" },
                    { text: "Aire espirado > 0,60 mg/l o sangre > 1,2 g/l", value: "d" }
                ],
                correctAnswer: "d"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "Tasa máxima de alcohol para menores (ciclomotores, bicis, patinetes):",
                options: [
                    { text: "0,15 mg/l en aire y 0,3 g/l en sangre", value: "a" },
                    { text: "0,25 mg/l en aire y 0,5 g/l en sangre", value: "b" },
                    { text: "0,0 mg/l en aire y 0,0 g/l en sangre", value: "c" },
                    { text: "0.05 mg/l en aire y 0,1 g/l en sangre", value: "d" }
                ],
                correctAnswer: "c"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "¿Qué delito comete un conductor que se niega a las pruebas de alcohol/drogas?",
                options: [
                    { text: "Delito de conducción temeraria", value: "a" },
                    { text: "Delito de desobediencia grave a la autoridad", value: "b" },
                    { text: "Delito de negativa a someterse a las pruebas", value: "c" },
                    { text: "Infracción administrativa grave", value: "d" }
                ],
                correctAnswer: "c"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "Según el art. 14 RDL 6/2015, ¿qué obligación tiene un conductor ante pruebas de alcohol/drogas?",
                options: [
                    { text: "Puede negarse sin consecuencias legales.", value: "a" },
                    { text: "Está obligado, y la negativa puede ser delito.", value: "b" },
                    { text: "Solo obligado si cometió infracción grave.", value: "c" },
                    { text: "Puede elegir entre prueba o multa.", value: "d" }
                ],
                correctAnswer: "b"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "En las pruebas de detección de drogas (proyecto DRUID), indica cuál NO sería un signo general:",
                options: [
                    { text: "Actitud y comportamiento", value: "a" },
                    { text: "Aspecto corporal general", value: "b" },
                    { text: "Conjuntiva enrojecida o con edema", value: "c" },
                    { text: "Aspecto de la cara", value: "d" },
                ],
                correctAnswer: "c"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "Como se denomina al aumento del diámetro o dilatación de la pupila del ojo, debiéndose a consumo de sustancias estupefacientes:",
                options: [
                    { text: "Miosis", value: "a" },
                    { text: "Midriasis", value: "b" },
                    { text: "Nistagmo", value: "c" },
                    { text: "Anisocoria", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "Como se denomina la contracción de la pupila, debiéndose a consumo de sustancias estupefacientes:",
                options: [
                    { text: "Miosis", value: "a" },
                    { text: "Midriasis", value: "b" },
                    { text: "Nistagmo", value: "c" },
                    { text: "Blefaroespasmo", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "Se conoce por los movimientos involuntarios que puede realizar el ojo, debiéndose a consumo de sustancias estupefacientes:",
                options: [
                    { text: "Miosis", value: "a" },
                    { text: "Midriasis", value: "b" },
                    { text: "Nistagmo", value: "c" },
                    { text: "Diplopía", value: "d"}
                ],
                correctAnswer: "c"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "¿Qué es el proyecto DRUID (Driving Under Influence of alcohol and drugs)?",
                options: [
                    { text: "Un programa de rehabilitación para conductores.", value: "a" },
                    { text: "Una iniciativa europea para prevención de accidentes con tecnologías avanzadas.", value: "b" },
                    { text: "Un proyecto europeo que estudia el impacto de alcohol, drogas y medicamentos en la conducción.", value: "c" },
                    { text: "Un sistema de clasificación de medicamentos.", value: "d" }
                ],
                correctAnswer: "c"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "En el procedimiento explorador de signos de influencia, cuando el 'paciente realiza una alegación', esto es un:",
                options: [
                    { text: "Signo", value: "a" },
                    { text: "Síntoma", value: "b" },
                    { text: "Diagnóstico", value: "c" },
                    { text: "Presunción", value: "d" }
                ],
                correctAnswer: "b"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "En el procedimiento explorador de signos de influencia, 'lo que el profesional percibe' es un:",
                options: [
                    { text: "Signo", value: "a" },
                    { text: "Síntoma", value: "b" },
                    { text: "Historial", value: "c" },
                    { text: "Testimonio", value: "d" }
                ],
                correctAnswer: "a"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "¿Los terrenos públicos dentro del Puerto tienen la consideración de vía?",
                options: [
                    { text: "Si", value: "a" },
                    { text: "No", value: "b" },
                    { text: "Solo si están asfaltados", value: "c" },
                    { text: "Depende de la autoridad portuaria", value: "d" }
                ],
                correctAnswer: "a"
            },
            {
                category: "Drogas", emoji: "💊",
                questionText: "Según el art. 3 Ley sobre Tráfico, ¿qué se entiende por 'vía'?",
                options: [
                    { text: "Espacio exclusivo para tránsito de vehículos a motor.", value: "a" },
                    { text: "Espacio de dominio común por donde transitan peatones o circulan vehículos.", value: "b" },
                    { text: "Solo autopistas y autovías.", value: "c" },
                    { text: "Solo calles y avenidas en poblado.", value: "d" }
                ],
                correctAnswer: "b"
            },

            // Transporte de Mercancías (de MMPP Ivaspe TEST T1.pdf)
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Qué leyes regulan el transporte terrestre de mercancías:",
                options: [ 
                    { text: "LOTT/ROTT", value: "a" }, 
                    { text: "ROTT/ADR", value: "b" },
                    { text: "Ley de Contratos de Transporte Terrestre", value: "c"},
                    { text: "Reglamento General de Vehículos", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Que norma específica será de aplicación para el transporte de MMPP:",
                options: [ 
                    { text: "LOTT", value: "a" }, 
                    { text: "ADR", value: "b" },
                    { text: "RID", value: "c"},
                    { text: "ROTT", value: "d"} 
                ],
                correctAnswer: "a"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "El transporte de viajeros y mercancías, serán aquellos realizados por:",
                options: [
                    { text: "Vehículos automóviles que circulen con camino de rodadura fija, y con medios fijos de captación de energía", value: "a" },
                    { text: "Vehículos automóviles que circulen sin camino de rodadura fija, y sin medios fijos de captación de energía", value: "b" },
                    { text: "Ferrocarriles y tranvías exclusivamente", value: "c"},
                    { text: "Cualquier medio que desplace personas o bienes", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "El transporte de mercancías, ¿de qué tipo de carácter puede ser?",
                options: [
                    { text: "Público únicamente", value: "a" },
                    { text: "Privado únicamente", value: "b" }, 
                    { text: "Público o Privado", value: "c" },
                    { text: "Internacional o Nacional exclusivamente", value: "d"}
                ],
                correctAnswer: "c" 
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "La LOTT, en el Capítulo I de su título III, efectúa las siguientes clasificaciones, según su naturaleza:",
                options: [
                    { text: "Públicos", value: "a" },
                    { text: "Privados", value: "b" },
                    { text: "Ambos (Públicos y Privados)", value: "c" },
                    { text: "Solo transporte de mercancías peligrosas", value: "d"}
                ],
                correctAnswer: "c"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Se consideran transportes públicos:",
                options: [
                    { text: "Aquellos que se llevan a cabo por cuenta ajena a cambio de una retribución económica.", value: "a" },
                    { text: "Aquellos que se llevan a cabo por cuenta propia, para satisfacer necesidades particulares o como complemento.", value: "b" },
                    { text: "Los realizados por entidades estatales sin ánimo de lucro.", value: "c"},
                    { text: "Los que utilizan vías públicas exclusivamente.", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Se consideran transportes privados:",
                options: [
                    { text: "Aquellos que se llevan a cabo por cuenta ajena a cambio de una retribución económica.", value: "a" },
                    { text: "Aquellos que se llevan a cabo por cuenta propia, para satisfacer necesidades particulares o como complemento de otras actividades.", value: "b" },
                    { text: "Los que no requieren autorización administrativa.", value: "c"},
                    { text: "Los que se realizan en vehículos de menos de 3.5T MMA.", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Según el art. 100 LOTT, los transportes privados particulares son:",
                options: [
                    { text: "Dedicados a satisfacer necesidades de desplazamiento personal/doméstico del titular y allegados, en vehículo turismo o ligeros.", value: "a" },
                    { text: "El que se lleva a cabo por empresas cuya finalidad principal no es de transporte, como complemento.", value: "b" },
                    { text: "Transporte de mercancías propias en furgonetas.", value: "c"},
                    { text: "Transporte remunerado de amigos o familiares.", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Según el art. 100 LOTT, los transportes privados complementarios son:",
                options: [
                    { text: "Dedicados a satisfacer necesidades de desplazamiento personal/doméstico.", value: "a" },
                    { text: "El que se lleva a cabo por empresas cuya finalidad principal no es de transporte, como complemento a su actividad principal.", value: "b" },
                    { text: "El transporte escolar realizado por el propio centro.", value: "c"},
                    { text: "El transporte de trabajadores de una empresa constructora a la obra.", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Los transportes públicos, dependiendo del itinerario y de la frecuencia, pueden ser:",
                options: [
                    { text: "Regulares o discrecionales.", value: "a" },
                    { text: "Irregulares o discrecionales", value: "b" },
                    { text: "Regulares o Irregulares", value: "c" },
                    { text: "Continuos o discontinuos", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Los transportes que se efectúan dentro de itinerarios preestablecidos, y con sujeción a calendarios y horarios prefijados, son:",
                options: [
                    { text: "Regulares", value: "a" },
                    { text: "Discrecionales", value: "b" },
                    { text: "Especiales", value: "c"},
                    { text: "Programados", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Los transportes que se llevan a cabo sin sujeción a itinerario, calendario ni horario preestablecido, son:",
                options: [
                    { text: "Regulares", value: "a" },
                    { text: "Discrecionales", value: "b" },
                    { text: "Eventuales", value: "c"},
                    { text: "No programados", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Los transportes públicos de mercancías por carretera tendrán en todo caso, aun cuando se produzca reiteración de itinerario, calendario y horario, la consideración de:",
                options: [
                    { text: "Regulares", value: "a" },
                    { text: "Discrecionales", value: "b" },
                    { text: "Mixtos", value: "c"},
                    { text: "Según contrato", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Los transportes que tienen su origen, trayecto y destino dentro del territorio del Estado español son:",
                options: [
                    { text: "Interiores", value: "a" },
                    { text: "Internacionales", value: "b" },
                    { text: "Nacionales", value: "c"}, 
                    { text: "Domésticos", value: "d"} 
                ],
                correctAnswer: "a"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Los transportes cuyo itinerario discurre parcialmente por el territorio de estados extranjeros son:",
                options: [
                    { text: "Interiores", value: "a" },
                    { text: "Internacionales", value: "b" },
                    { text: "Transfronterizos", value: "c"}, 
                    { text: "Exteriores", value: "d"} 
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "¿Qué tipos de autorizaciones de transporte de mercancías (Tarjetas de Transporte) existen?",
                options: [
                    { text: "Mercancías Discrecional Ligero (MDL)", value: "a" },
                    { text: "Mercancías Discrecional Pesado (MDP)", value: "b" },
                    { text: "Mercancías Privado Complementario (MPC)", value: "c" },
                    { text: "Todas las anteriores", value: "d" }
                ],
                correctAnswer: "d"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Como se denomina al documento administrativo que acredita que un vehículo está autorizado para el transporte de cargas dentro de un territorio.",
                options: [
                    { text: "Permiso de transporte", value: "a" },
                    { text: "Tarjeta de transporte", value: "b" },
                    { text: "Tarjeta de embarque", value: "c" },
                    { text: "Licencia de circulación de mercancías", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Se exige la tarjeta de transporte a vehículos de transporte público de mercancías de terceros con MMA por encima de:",
                options: [
                    { text: "3 toneladas", value: "a" },
                    { text: "2.5 toneladas", value: "b" },
                    { text: "2 toneladas", value: "c" },
                    { text: "3.5 toneladas", value: "d"}
                ],
                correctAnswer: "c"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Si las mercancías trasladadas son propias, la tarjeta de transporte será obligatoria para una MMA superior a:",
                options: [
                    { text: "2 toneladas", value: "a" },
                    { text: "3 toneladas", value: "b" },
                    { text: "2.5 toneladas", value: "c" },
                    { text: "3.5 toneladas", value: "d" }
                ],
                correctAnswer: "d"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Las Tarjetas MDL son para empresas con vehículos ligeros cuya capacidad de carga sumada no exceda de:",
                options: [
                    { text: "50 Tm", value: "a" },
                    { text: "60 Tm", value: "b" },
                    { text: "70 Tm", value: "c" },
                    { text: "40 Tm", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Las Tarjetas MDP son para empresas con al menos un vehículo pesado, o con ligeros si la suma de carga excede de:",
                options: [
                    { text: "50 Tm", value: "a" },
                    { text: "60 Tm", value: "b" },
                    { text: "70 Tm", value: "c" },
                    { text: "80 Tm", value: "d"}
                ],
                correctAnswer: "b" 
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Son vehículos ligeros aquellos cuya MMA sea igual o inferior a 6.000 Kg, o aun siendo superior, su carga útil sea igual o inferior a:",
                options: [
                    { text: "3.000 Kg", value: "a" },
                    { text: "3.500 Kg", value: "b" },
                    { text: "4.000 Kg", value: "c" },
                    { text: "2.500 Kg", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Son vehículos pesados aquellos cuya MMA sea superior a 6.000 Kg y que su capacidad de carga útil sea superior a:",
                options: [
                    { text: "3.000 Kg", value: "a" },
                    { text: "3.500 Kg", value: "b" },
                    { text: "4.000 Kg", value: "c" },
                    { text: "2.500 Kg", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Los Visados de las tarjetas de transporte deben ser, según RD 1830/1999:",
                options: [
                    { text: "Anuales", value: "a" },
                    { text: "Bianuales", value: "b" },
                    { text: "Mensuales", value: "c" },
                    { text: "Trimestrales", value: "d" }
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Excepto las autorizaciones de transporte (VT), que se visan cada:",
                options: [
                    { text: "Año", value: "a" },
                    { text: "Dos años", value: "b" }, 
                    { text: "Tres años", value: "c" },
                    { text: "Cuatro años", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "¿La no renovación del Visado en fecha conlleva la pérdida de su vigencia?",
                options: [
                    { text: "Si", value: "a" },
                    { text: "No", value: "b" },
                    { text: "Solo si es transporte público", value: "c"},
                    { text: "Solo si es transporte internacional", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Una vez perdida la vigencia del visado, ¿en qué plazo se podría solicitar su rehabilitación?",
                options: [
                    { text: "En el año siguiente", value: "a" },
                    { text: "A los dos años siguientes", value: "b" },
                    { text: "Al mes del año siguiente", value: "c" },
                    { text: "En los seis meses siguientes", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Para la realización de la actividad de transporte por conductores de terceros países se necesita:",
                options: [
                    { text: "Tarjeta de transporte del vehículo", value: "a" },
                    { text: "Certificado de Conductor", value: "b" },
                    { text: "Visado Schengen", value: "c" },
                    { text: "Permiso de trabajo específico para transporte", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Transporte de Mercancías", emoji: "🚚",
                questionText: "Si un conductor de tercer país con Certificado cambia de empresa, ¿la nueva empresa debe solicitar un nuevo Certificado?",
                options: [
                    { text: "Si", value: "a" },
                    { text: "No, el certificado es del conductor", value: "b" },
                    { text: "Solo si cambia de tipo de vehículo", value: "c"},
                    { text: "Solo si han pasado más de 6 meses", value: "d"}
                ],
                correctAnswer: "a"
            },

            // Mercancías Peligrosas (ADR) (de MMPP T2,3,5.pdf)
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "¿Qué es el ADR?",
                options: [
                    { text: "Un reglamento nacional español sobre ferrocarril.", value: "a" },
                    { text: "Un acuerdo europeo relativo al transporte internacional de mercancías peligrosas por carretera.", value: "b" },
                    { text: "Un código marítimo internacional.", value: "c" },
                    { text: "Un acuerdo europeo para transporte nacional.", value: "d" }
                ],
                correctAnswer: "b"
            },
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "En el ADR, las disposiciones sobre embalaje y etiquetado de mercancías peligrosas se encuentran en el:",
                options: [
                    { text: "Anejo A", value: "a" },
                    { text: "Anejo B", value: "b" },
                    { text: "Anejo C", value: "c"},
                    { text: "Capítulo 3.2", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "En el ADR, las disposiciones sobre construcción, equipamiento y explotación de vehículos para mercancías peligrosas están en el:",
                options: [
                    { text: "Anejo A", value: "a" },
                    { text: "Anejo B", value: "b" },
                    { text: "Anejo C", value: "c"},
                    { text: "Parte 9", value: "d"} 
                ],
                correctAnswer: "b"
            },
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "Los anejos A y B del ADR, ¿de cuántas partes se componen en total?",
                options: [
                    { text: "1 parte", value: "a" },
                    { text: "5 partes", value: "b" },
                    { text: "7 partes", value: "c" }, 
                    { text: "9 partes", value: "d" }  
                ],
                correctAnswer: "d"
            },
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "Excepcionalmente, se puede autorizar el almacenamiento temporal en puertos de explosivos de la clase:",
                options: [
                    { text: "Clase 1.1", value: "a" },
                    { text: "Clase 1.2", value: "b" },
                    { text: "Clase 1.3", value: "c" },
                    { text: "Clase 1.4", value: "d" }
                ],
                correctAnswer: "d"
            },
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "Según el grupo de embalaje respecto al peligro que presentan, indica la correspondencia correcta:",
                options: [
                    { text: "Grupo de embalaje I (X) - Peligro alto", value: "a" },
                    { text: "Grupo de embalaje II (Y) - Peligro medio", value: "b" },
                    { text: "Grupo de embalaje III (Z) - Peligro bajo", value: "c" },
                    { text: "Todas son correctas", value: "d" }
                ],
                correctAnswer: "d"
            },
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "Los vehículos que transporten mercancías peligrosas deben portar un panel de color:",
                options: [
                    { text: "Naranja", value: "a" },
                    { text: "Verde", value: "b" },
                    { text: "Rojo", value: "c" },
                    { text: "Azul", value: "d" }
                ],
                correctAnswer: "a"
            },
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "En el panel naranja del ADR, ¿qué información aporta la parte superior e inferior?",
                options: [
                    { text: "Superior: Clase; Inferior: Mercancía", value: "a" },
                    { text: "Superior: Nº de identificación del peligro; Inferior: Nº ONU", value: "b" },
                    { text: "Superior: Nº ONU; Inferior: Nº de identificación del peligro", value: "c" },
                    { text: "Superior: Mercancía; Inferior: Clase", value: "d" }
                ],
                correctAnswer: "b"
            },
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "En el Nº de identificación del peligro (parte superior panel naranja), el primer y segundo número indican:",
                options: [
                    { text: "Primer nº: Peligro principal; Segundo nº: Peligro secundario", value: "a" },
                    { text: "Primer nº: Peligro secundario; Segundo nº: Peligro principal", value: "b" },
                    { text: "Primer nº: Peligro especial; Segundo nº: Peligro secundario", value: "c" },
                    { text: "Ambos indican el peligro principal", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "Si el número de identificación del peligro está precedido por la letra 'X', indica que:",
                options: [
                    { text: "La materia reacciona peligrosamente con el agua", value: "a" },
                    { text: "La materia reacciona peligrosamente con las sustancias oxidantes", value: "b" },
                    { text: "La materia reacciona peligrosamente con los gases", value: "c" },
                    { text: "La materia reacciona peligrosamente con los sólidos inflamables", value: "d" }
                ],
                correctAnswer: "a"
            },
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "Respecto a los bultos con mercancías peligrosas, salvo que se disponga otra cosa, ¿deben ir etiquetados?",
                options: [
                    { text: "Si", value: "a" },
                    { text: "No", value: "b" },
                    { text: "Solo si superan los 5kg", value: "c"},
                    { text: "Solo si son líquidos", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "En cada bulto con mercancías peligrosas deberá figurar:",
                options: [
                    { text: "Nº ONU, precedido de las letras 'UN'", value: "a" },
                    { text: "UN, precedido de las letras 'ONU'", value: "b" },
                    { text: "OCU, precedido de las letras 'UN'", value: "c" },
                    { text: "ONU, precedido de las letras 'UNO'", value: "d" }
                ],
                correctAnswer: "a"
            },
            {
                category: "Mercancías Peligrosas (ADR)", emoji: "🔥",
                questionText: "En el caso de los objetos no embalados, el marcado de mercancía peligrosa deberá figurar sobre:",
                options: [
                    { text: "El palet che lo transporta", value: "a" },
                    { text: "Únicamente en un bulto representativo", value: "b" },
                    { text: "Sobre el propio objeto", value: "c" },
                    { text: "En la documentación del vehículo", value: "d"}
                ],
                correctAnswer: "c"
            },

            // Tácticas Policiales (de Tácticas Policiales. TEST.pdf)
            {
                category: "Tácticas Policiales", emoji: "👮",
                questionText: "El sistema nervioso central se integra de:",
                options: [ 
                    { text: "Encéfalo y médula espinal", value: "a" }, 
                    { text: "Sistema nervioso simpático y parasimpático", value: "b" }, 
                    { text: "Sistema nervioso periférico y autónomo", value: "c" },
                    { text: "Cerebro, cerebelo y bulbo raquídeo", value: "d" } 
                ],
                correctAnswer: "a" 
            },
             {
                category: "Tácticas Policiales", emoji: "👮",
                questionText: "El Sistema nervioso simpático se integra en:",
                options: [ 
                    { text: "Cortex cerebral", value: "a" },
                    { text: "Respuesta automática", value: "b" }, 
                    { text: "Respuesta razonada", value: "c" },
                    { text: "Sistema nervioso periférico exclusivamente", value: "d" }
                ],
                correctAnswer: "b" 
            },
            {
                category: "Tácticas Policiales", emoji: "👮",
                questionText: "El Sistema nervioso parasimpático se integra en:",
                options: [ 
                    { text: "Cortex cerebral", value: "a" },
                    { text: "Respuesta automática", value: "b" }, 
                    { text: "Respuesta razonada", value: "c" },
                    { text: "Sistema nervioso periférico exclusivamente", value: "d" }
                ],
                correctAnswer: "c" 
            },
            {
                category: "Tácticas Policiales", emoji: "👮",
                questionText: "Las 3 F's (respuestas al estrés agudo) se componen de:",
                options: [
                    { text: "Huida (Flight), Lucha/Ataque defensivo (Fight) y Congelación (Freeze)", value: "a" },
                    { text: "Fly, fight y feel", value: "b" },
                    { text: "Huida, lucha/ataque ofensivo y congelación", value: "c" },
                    { text: "Focus, Fight, Flee", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Tácticas Policiales", emoji: "👮",
                questionText: "En los 5 pilares de la supervivencia, el elemento más importante es:",
                options: [
                    { text: "Preparación física", value: "a" },
                    { text: "La actitud o preparación mental", value: "b" },
                    { text: "La suerte", value: "c" },
                    { text: "El equipamiento táctico", value: "d"}
                ],
                correctAnswer: "b"
            },
            {
                category: "Tácticas Policiales", emoji: "👮",
                questionText: "Por orden, los objetivos de integridad en una intervención policial son:",
                options: [
                    { text: "Jurídica, física y laboral", value: "a" },
                    { text: "Jurídica, laboral y física", value: "b" },
                    { text: "Física, jurídica y laboral", value: "c" },
                    { text: "Física, psicológica y material", value: "d"}
                ],
                correctAnswer: "c"
            },
            {
                category: "Tácticas Policiales", emoji: "👮",
                questionText: "Los 3 principios básicos de actuación en el uso de la fuerza son:",
                options: [
                    { text: "Oportunidad, congruencia y proporcionalidad", value: "a" },
                    { text: "Visión del peligro, actuación y proporcionalidad", value: "b" },
                    { text: "Oportunidad, intencionalidad y proporcionalidad", value: "c" },
                    { text: "Legalidad, necesidad y proporcionalidad", value: "d"} 
                ],
                correctAnswer: "a" 
            },
            {
                category: "Tácticas Policiales", emoji: "👮",
                questionText: "El orden de procedimiento en una intervención es:",
                options: [
                    { text: "Tácticas, número de intervinientes y técnicas", value: "a" },
                    { text: "Número de intervinientes, técnicas y tácticas", value: "b" },
                    { text: "Número de intervinientes, tácticas y técnicas", value: "c" },
                    { text: "Identificación, valoración y actuación", value: "d"}
                ],
                correctAnswer: "c"
            },
            {
                category: "Tácticas Policiales", emoji: "👮",
                questionText: "A la hora de engrilletar se debe hacer:",
                options: [
                    { text: "Esposar/engrilletar de cubito prono (manos a la espalda y dorso con dorso)", value: "a" },
                    { text: "Esposar/engrilletar de cubito prono (manos a la espalda y palma con palma)", value: "b" },
                    { text: "Esposar/engrilletar de cubito prono (manos delante y dorso con dorso)", value: "c" },
                    { text: "De pie, manos a la espalda y palmas hacia afuera", value: "d"}
                ],
                correctAnswer: "a"
            },
            {
                category: "Tácticas Policiales", emoji: "👮",
                questionText: "Según los tipos de intervención, pueden ser:",
                options: [
                    { text: "Alto riesgo y riesgo moderado", value: "a" },
                    { text: "Riesgo moderado y riesgo de alto nivel", value: "b" },
                    { text: "Alto riesgo y riesgo desconocido", value: "c" },
                    { text: "Riesgo bajo, medio y alto", value: "d"}
                ],
                correctAnswer: "c"
            }
        ];

        // --- DOM ELEMENTOS ---
        const studyMethodSelectionScreen = document.getElementById('studyMethodSelectionScreen');
        const studyTestSelectionScreen = document.getElementById('studyTestSelectionScreen');
        const examTestSelectionScreen = document.getElementById('examTestSelectionScreen');
        const topicSelectionScreen = document.getElementById('topicSelectionScreen');
        const countdownScreen = document.getElementById('countdownScreen');
        const testScreen = document.getElementById('testScreen');
        const resultsScreen = document.getElementById('resultsScreen');
        const questionContainer = document.getElementById('questionContainer');
        
        const globalProgressWrapperNavbar = document.getElementById('globalProgressWrapperNavbar');
        const progressBarNavbar = document.getElementById('progressBarNavbar');
        const progressInfoTextNavbar = document.getElementById('progressInfoTextNavbar');


        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const finishButton = document.getElementById('finishButton');
        const topicGrid = document.getElementById('topicGrid');
        const correctionButtonContainer = document.getElementById('correctionButtonContainer');
        const instantCorrectionFeedback = document.getElementById('instantCorrectionFeedback');
        const backFromTopicSelectionButton = document.getElementById('backFromTopicSelectionButton');


        // Modal elements
        const messageModal = document.getElementById('messageModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');

        // --- LÓGICA DE LA APLICACIÓN ---

        function showScreen(screenId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            const screenToShow = document.getElementById(screenId);
            if (screenToShow) {
                screenToShow.classList.add('active');
            } else {
                console.error("Error: Pantalla no encontrada -", screenId);
            }

            // Controlar visibilidad de la barra de progreso y clase en body para estilos móviles
            if (screenId === 'testScreen') {
                globalProgressWrapperNavbar.style.display = 'block';
                document.body.classList.add('test-mode-active');
            } else {
                globalProgressWrapperNavbar.style.display = 'none';
                document.body.classList.remove('test-mode-active');
            }
        }
        
        function selectStudyMethod(method) {
            currentStudyMethodType = method;
            if (method === 'study') {
                showScreen('studyTestSelectionScreen');
            } else if (method === 'exam') {
                showScreen('examTestSelectionScreen');
            }
        }

        function showTopicSelectionScreen(studyMethod) {
            populateTopicGrid();
            showScreen('topicSelectionScreen');
            if (currentStudyMethodType === 'study') {
                backFromTopicSelectionButton.onclick = () => showScreen('studyTestSelectionScreen');
            } else { 
                backFromTopicSelectionButton.onclick = () => showScreen('examTestSelectionScreen');
            }
        }


        function populateTopicGrid() {
            const topics = [...new Set(allQuestions.map(q => q.category))];
            topicGrid.innerHTML = '';
            topics.forEach(topic => {
                const topicEmoji = allQuestions.find(q => q.category === topic)?.emoji || '📚';
                const button = document.createElement('button');
                button.className = `btn topic-button ${currentStudyMethodType === 'study' ? 'btn-study' : 'btn-exam'}`;
                button.innerHTML = `${topicEmoji} ${topic}`;
                button.onclick = () => startTest('topic_specific', topic, currentStudyMethodType);
                topicGrid.appendChild(button);
            });
        }

        function startTest(scope, topic = '', studyMethod) {
            currentTestScope = scope;
            selectedTopic = topic;
            currentStudyMethodType = studyMethod; 
            currentQuestionIndex = 0;
            userAnswers = [];
            score = 0;

            if (scope === 'all_questions') {
                loadedQuestions = shuffleArray([...allQuestions]); 
            } else if (scope === 'topic_specific') {
                loadedQuestions = allQuestions.filter(q => q.category === selectedTopic);
                if (loadedQuestions.length === 0) {
                    showMessage("Error", `No hay preguntas cargadas para el tema: ${selectedTopic}.`);
                    return;
                }
                loadedQuestions = shuffleArray([...loadedQuestions]); 
            }
             if (loadedQuestions.length === 0) {
                showMessage("Error", "No hay preguntas disponibles para este test.");
                showScreen('studyMethodSelectionScreen');
                return;
            }

            updateProgressBar(); 
            showScreen('countdownScreen');
            startCountdown();
        }

        function startCountdown() {
            let count = 3;
            document.getElementById('countdown').textContent = count;
            countdownTimer = setInterval(() => {
                count--;
                document.getElementById('countdown').textContent = count;
                if (count === 0) {
                    clearInterval(countdownTimer);
                    showScreen('testScreen'); 
                    displayQuestion();
                }
            }, 1000);
        }

        function displayQuestion() {
            if (currentQuestionIndex < 0 || currentQuestionIndex >= loadedQuestions.length) {
                finishTest(); 
                return;
            }
            const question = loadedQuestions[currentQuestionIndex];
            const questionGlobalIndex = allQuestions.indexOf(question); 

            let testModeInfoText = `Modo: ${currentStudyMethodType === 'study' ? 'Estudio' : 'Examen'}`;
            if (currentTestScope === 'topic_specific') {
                testModeInfoText += ` - Tema: ${selectedTopic}`;
            } else {
                testModeInfoText += ` - Test Completo`;
            }

            let optionsHTML = '';
            const shuffledOptions = shuffleArray([...question.options]);

            shuffledOptions.forEach(option => {
                const userAnswerEntry = userAnswers.find(ua => ua.questionGlobalIndex === questionGlobalIndex);
                const isSelected = userAnswerEntry && userAnswerEntry.answer === option.value;
                const isDisabled = userAnswerEntry && userAnswerEntry.correctedInStudy ? 'disabled' : '';
                
                optionsHTML += `<div class="option ${isSelected ? 'selected' : ''} ${isDisabled}" data-value="${option.value}" onclick="selectAnswer(this, '${option.value}')">${option.text}</div>`;
            });

            questionContainer.innerHTML = `
                <div class="question-header">
                    <span class="question-category">${question.emoji} ${question.category}</span>
                    <span class="question-number">Pregunta ${currentQuestionIndex + 1} de ${loadedQuestions.length}</span>
                    <div class="test-mode-info">${testModeInfoText}</div>
                </div>
                <div class="question-text">${question.questionText}</div>
                <div class="options">${optionsHTML}</div>
            `;

            correctionButtonContainer.innerHTML = ''; 
            instantCorrectionFeedback.style.display = 'none'; 
            instantCorrectionFeedback.className = 'mt-3 p-3 rounded-md text-center'; 

            const userAnswerEntry = userAnswers.find(ua => ua.questionGlobalIndex === questionGlobalIndex);
            if (currentStudyMethodType === 'study') {
                if (userAnswerEntry && userAnswerEntry.correctedInStudy) {
                    showInstantFeedback(questionGlobalIndex, userAnswerEntry.answer);
                    disableOptionsForCurrentQuestion(true);
                } else {
                    const correctBtn = document.createElement('button');
                    correctBtn.className = 'btn btn-secondary'; 
                    correctBtn.textContent = '💡 Corregir esta pregunta';
                    correctBtn.onclick = checkCurrentQuestion;
                    correctionButtonContainer.appendChild(correctBtn);
                    disableOptionsForCurrentQuestion(false); 
                }
            } else {
                 disableOptionsForCurrentQuestion(false); 
            }

            updateNavigationButtons();
            updateProgressBar();
        }
        
        function disableOptionsForCurrentQuestion(disable) {
            const optionsElements = questionContainer.querySelectorAll('.option');
            optionsElements.forEach(opt => {
                if (disable) {
                    opt.classList.add('disabled');
                } else {
                    opt.classList.remove('disabled');
                }
            });
        }

        function showInstantFeedback(questionGlobalIndex, userAnswerValue) {
            const question = allQuestions[questionGlobalIndex];
            if (!question) return;

            const isCorrect = userAnswerValue === question.correctAnswer;
            instantCorrectionFeedback.textContent = isCorrect ? '¡Correcto! ✅' : 'Incorrecto. ❌';
            instantCorrectionFeedback.classList.add(isCorrect ? 'correct' : 'incorrect');
            instantCorrectionFeedback.style.display = 'block';

            const optionsElements = questionContainer.querySelectorAll('.option');
            optionsElements.forEach(opt => {
                opt.classList.remove('selected'); 
                if (opt.dataset.value === question.correctAnswer) {
                    opt.classList.add('correct');
                }
                if (opt.dataset.value === userAnswerValue && !isCorrect) {
                    opt.classList.add('incorrect');
                }
            });
        }


        function checkCurrentQuestion() {
            const question = loadedQuestions[currentQuestionIndex];
            const questionGlobalIndex = allQuestions.indexOf(question);
            const userAnswerEntry = userAnswers.find(ua => ua.questionGlobalIndex === questionGlobalIndex);

            if (!userAnswerEntry) {
                showMessage("Atención", "Por favor, selecciona una respuesta antes de corregir.");
                return;
            }

            userAnswerEntry.correctedInStudy = true;
            
            showInstantFeedback(questionGlobalIndex, userAnswerEntry.answer);
            disableOptionsForCurrentQuestion(true); 
            correctionButtonContainer.innerHTML = ''; 
        }


        function selectAnswer(optionElement, answerValue) {
            const question = loadedQuestions[currentQuestionIndex];
            const questionGlobalIndex = allQuestions.indexOf(question);
            
            const existingAnswer = userAnswers.find(ua => ua.questionGlobalIndex === questionGlobalIndex);
            if (existingAnswer && existingAnswer.correctedInStudy) {
                return; 
            }

            const questionOptions = optionElement.parentElement.querySelectorAll('.option');
            questionOptions.forEach(opt => opt.classList.remove('selected'));
            optionElement.classList.add('selected');

            if (existingAnswer) {
                existingAnswer.answer = answerValue;
            } else {
                userAnswers.push({ questionGlobalIndex: questionGlobalIndex, answer: answerValue, correctedInStudy: false });
            }
        }

        function updateNavigationButtons() {
            prevButton.style.display = currentQuestionIndex === 0 ? 'none' : 'inline-block';
            const isLastQuestion = currentQuestionIndex === loadedQuestions.length - 1;
            nextButton.style.display = isLastQuestion ? 'none' : 'inline-block';
            finishButton.style.display = isLastQuestion ? 'inline-block' : 'none';
        }

        function updateProgressBar() {
            if (loadedQuestions.length === 0) {
                progressBarNavbar.style.width = '0%';
                progressInfoTextNavbar.textContent = 'Progreso: 0%';
                return;
            }
            const percentage = Math.round(((currentQuestionIndex +1) / loadedQuestions.length) * 100);
            progressBarNavbar.style.width = percentage + '%';
            progressInfoTextNavbar.textContent = `Progreso: ${percentage}% (${currentQuestionIndex + 1}/${loadedQuestions.length})`;
        }

        function nextQuestion() {
            const question = loadedQuestions[currentQuestionIndex];
            const questionGlobalIndex = allQuestions.indexOf(question);
            const userAnswerEntry = userAnswers.find(ua => ua.questionGlobalIndex === questionGlobalIndex);

            if (!userAnswerEntry) {
                showMessage("Atención", "Por favor, selecciona una respuesta antes de continuar.");
                return;
            }
            if (currentQuestionIndex < loadedQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function finishTest() {
            let unansweredInCurrentTest = 0;
            for(let i = 0; i < loadedQuestions.length; i++) {
                const qGlobalIndex = allQuestions.indexOf(loadedQuestions[i]);
                if (!userAnswers.some(ua => ua.questionGlobalIndex === qGlobalIndex)) {
                    unansweredInCurrentTest++;
                }
            }

            if (unansweredInCurrentTest > 0) {
                 showMessage("Confirmación", `Hay ${unansweredInCurrentTest} pregunta(s) sin responder. ¿Deseas finalizar de todas formas?`, true, () => calculateAndShowResults());
                 return;
            }
            calculateAndShowResults();
        }

        function calculateAndShowResults() {
            score = 0;
            loadedQuestions.forEach(question => {
                const questionGlobalIndex = allQuestions.indexOf(question);
                const userAnswerEntry = userAnswers.find(ua => ua.questionGlobalIndex === questionGlobalIndex);
                if (userAnswerEntry && userAnswerEntry.answer === question.correctAnswer) {
                    score++;
                }
            });

            const percentage = loadedQuestions.length > 0 ? (score / loadedQuestions.length) * 100 : 0;
            document.getElementById('scorePercentage').textContent = `${percentage.toFixed(0)}%`;
            document.getElementById('correctAnswers').textContent = score;
            document.getElementById('totalAnswered').textContent = loadedQuestions.length;

            displayResultsSummary();
            showScreen('resultsScreen');
        }

        function displayResultsSummary() {
            const summaryContainer = document.getElementById('resultsSummary');
            summaryContainer.innerHTML = '<h4>Resumen de tus respuestas:</h4>';

            loadedQuestions.forEach((question, index) => {
                const questionGlobalIndex = allQuestions.indexOf(question);
                const userAnswerEntry = userAnswers.find(ua => ua.questionGlobalIndex === questionGlobalIndex);
                const userAnswerValue = userAnswerEntry ? userAnswerEntry.answer : "No respondida"; 
                const isCorrect = userAnswerEntry ? userAnswerEntry.answer === question.correctAnswer : false;

                const resultItem = document.createElement('div');
                resultItem.classList.add('result-item', isCorrect ? 'correct' : 'incorrect');

                let userAnswerText = "No respondida";
                if (userAnswerEntry && userAnswerEntry.answer) { 
                    const userAnswerOption = question.options.find(opt => opt.value === userAnswerEntry.answer);
                    userAnswerText = userAnswerOption ? userAnswerOption.text : "Respuesta inválida";
                }
                
                const correctAnswerOption = question.options.find(opt => opt.value === question.correctAnswer);
                const correctAnswerText = correctAnswerOption ? correctAnswerOption.text : "Correcta no definida";

                resultItem.innerHTML = `
                    <p><strong>Pregunta ${index + 1}:</strong> ${question.questionText}</p>
                    <p><em>Tu respuesta: ${userAnswerText} ${isCorrect ? '✅' : (userAnswerEntry && userAnswerEntry.answer ? '❌' : '')}</em></p>
                    ${!isCorrect ? `<p><em>Respuesta correcta: ${correctAnswerText}</em></p>` : ''}
                `;
                summaryContainer.appendChild(resultItem);
            });
        }

        function restartApp() {
            currentQuestionIndex = 0;
            userAnswers = [];
            score = 0;
            loadedQuestions = [];
            if(progressBarNavbar) progressBarNavbar.style.width = '0%';
            if(progressInfoTextNavbar) progressInfoTextNavbar.textContent = 'Progreso: 0%';
            showScreen('studyMethodSelectionScreen'); 
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function showMessage(title, message, showConfirm = false, confirmCallback = null) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            
            const modalContent = messageModal.querySelector('.modal-content');
            const existingActionButtons = modalContent.querySelectorAll('button.btn-modal-action, button.btn-modal-cancel');
            existingActionButtons.forEach(btn => btn.remove());

            const defaultButton = modalContent.querySelector('button.btn');
            defaultButton.style.display = 'inline-block';
            defaultButton.textContent = "Aceptar";
            defaultButton.onclick = closeModal;

            if (showConfirm && confirmCallback) {
                defaultButton.style.display = 'none';

                const confirmBtn = document.createElement('button');
                confirmBtn.textContent = "Sí, finalizar";
                confirmBtn.className = "btn btn-training btn-modal-action"; 
                confirmBtn.onclick = () => {
                    closeModal();
                    confirmCallback();
                };

                const cancelBtn = document.createElement('button');
                cancelBtn.textContent = "No, continuar";
                cancelBtn.className = "btn btn-secondary btn-modal-cancel";
                cancelBtn.onclick = closeModal;
                
                modalContent.appendChild(cancelBtn);
                modalContent.appendChild(confirmBtn);
            }
            
            messageModal.style.display = "flex";
        }

        function closeModal() {
            messageModal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == messageModal) {
                closeModal();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            showScreen('studyMethodSelectionScreen'); 
            document.getElementById('currentYear').textContent = new Date().getFullYear();
        });
    </script>
</body>
</html>
